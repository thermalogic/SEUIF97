/*
 Backward Equation for Region 3:

IAPWS-IF97-S03rev: Supp-Tv(ph,ps)3-2014.pdf
     (p,h) -T,v
     (p,s)->T,v
 */
#include <math.h>
#include "region3.h"
#include "../common/constand.h"
#include "../algo/algorithm.h"

//  Initialize coefphicients and exponents for region 3

double p2h3ab(double p)
{
  // Page 6 Table 2. Numerical values of the coefficients of the equation h3ab(p) in
  // its dimensionless form, Eq. (1), for defining the boundary
  // between subregions 3a and 3b
  static double n[4] = {0.201464004206875E+04,
                        0.374696550136983E+01,
                        -0.219921901054187E-01,
                        0.875131686009950E-04};
  double eta, pi;
  pi = p / 1.0;
  eta = n[0] + pi * (n[1] + pi * (n[2] + n[3] * pi));
  return (eta * 1.0);
}

double theta3aph(double pi, double eta)
{
  // (p,h)->T for region 3a
  // Page7 Table 3. Coefficients and exponents of the backward equation T3a(p,h) for subregion 3a in its
  // dimensionless form, Eq. (2)
  IJnData IJn[31] = {
      {-12, 0, -1.33645667811215e-7},
      {-12, 1, 4.55912656802978e-6},
      {-12, 2, -1.46294640700979e-5},
      {-12, 6, 6.39341312970080e-3},
      {-12, 14, 3.72783927268847e2},

      {-12, 16, -7.18654377460447e3},
      {-12, 20, 5.73494752103400e5},
      {-12, 22, -2.67569329111439e6},
      {-10, 1, -3.34066283302614e-5},
      {-10, 5, -2.45479214069597e-2},

      {-10, 12, 4.78087847764996e1},
      {-8, 0, 7.64664131818904e-6},
      {-8, 2, 1.28350627676972e-3},
      {-8, 4, 1.71219081377331e-2},
      {-8, 10, -8.51007304583213},

      {-5, 2, -1.36513461629781e-2},
      {-3, 0, -3.84460997596657e-6},
      {-2, 1, 3.37423807911655e-3},
      {-2, 3, -5.51624873066791e-1},
      {-2, 4, 7.29202277107470e-1},

      {-1, 0, -9.92522757376041e-3},
      {-1, 2, -1.19308831407288e-1},
      {0, 0, 7.93929190615421e-1},
      {0, 1, 4.54270731799386e-1},
      {1, 1, 2.09998591259910e-1},

      {3, 0, -6.42109823904738e-3},
      {3, 1, -2.35155868604540e-2},
      {4, 0, 2.52233108341612e-3},
      {4, 3, -7.64885133368119e-3},
      {10, 4, 1.36176427574291e-2},

      {12, 5, -1.33027883575669e-2}};

  pi = pi + 0.240;
  eta = eta - 0.615;
  // theta = 0.0;
  // for (int k = 0; k < 31; k++)
  //   theta += IJn[k].n * pow(pi, IJn[k].I) * pow(eta, IJn[k].J);

  double theta = poly(pi, eta, 31, IJn);
  return (theta);
}

double ph2T3a_reg3(double p, double h)
{
  double eta, pi;
  pi = p / 100.0;
  eta = h / 2300.0;
  return (760.0 * theta3aph(pi, eta));
}
//-------------------------------------------------
// (p,h)   3b
//--------------------------------------------------
double theta3bph(double pi, double eta)
{
  // Table 4. Coefficients and exponents of the backward equation T3b=(p,h) for subregion 3b in its
  // dimensionless form, Eq. (3)
  IJnData IJn[33] = {
      {-12, 0, 3.23254573644920e-5},
      {-12, 1, -1.27575556587181e-4},
      {-10, 0, -4.75851877356068e-4},
      {-10, 1, 1.56183014181602e-3},
      {-10, 5, 1.05724860113781e-1},

      {-10, 10, -8.58514221132534e1},
      {-10, 12, 7.24140095480911e2},
      {-8, 0, 2.96475810273257e-3},
      {-8, 1, -5.92721983365988e-3},
      {-8, 2, -1.26305422818666e-2},

      {-8, 4, -1.15716196364853e-1},
      {-8, 10, 8.49000969739595e1},
      {-6, 0, -1.08602260086615e-2},
      {-6, 1, 1.54304475328851e-2},
      {-6, 2, 7.50455441524466e-2},

      {-4, 0, 2.52520973612982e-2},
      {-4, 1, -6.02507901232996e-2},
      {-3, 5, -3.07622221350501},
      {-2, 0, -5.74011959864879e-2},
      {-2, 4, 5.03471360939849},

      {-1, 2, -9.25081888584834e-1},
      {-1, 4, 3.91733882917546},
      {-1, 6, -7.73146007130190e1},
      {-1, 10, 9.49308762098587e3},
      {-1, 14, -1.41043719679409e6},

      {-1, 16, 8.49166230819026e6},
      {0, 0, 8.61095729446704e-1},
      {0, 2, 3.23346442811720e-1},
      {1, 1, 8.73281936020439e-1},
      {3, 1, -4.36653048526683e-1},

      {5, 1, 2.86596714529479e-1},
      {6, 1, -1.31778331276228e-1},
      {8, 1, 6.76682064330275e-3}};

  pi = pi + 0.298;
  eta = eta - 0.720;
  // theta = 0.0;
  // for (int k = 0; k < 33; k++)
  // theta += IJn[k].n * pow(pi, IJn[k].I) * pow(eta, IJn[k].J);
  double theta = poly(pi, eta, 33, IJn);
  return (theta);
}

double ph2T3b_reg3(double p, double h)
{
  double eta, pi;
  pi = p / 100.0;
  eta = h / 2800.0;
  return (860.0 * theta3bph(pi, eta));
}
//----------------------------------------------
// Region 3a (p,h)->v
//----------------------------------------------
double omega3aph(double pi, double eta)
{
  // Page9 Table 6. Coefficients and exponents of the backward equation v3a(p,h) for subregion 3a in its
  // dimensionless form, Eq. (4)
  IJnData IJn[] = {
      {-12, 6, 5.29944062966028e-3},
      {-12, 8, -1.70099690234461e-1},
      {-12, 12, 1.11323814312927e1},
      {-12, 18, -2.17898123145125e3},
      {-10, 4, -5.06061827980875e-4},
      {-10, 7, 5.56495239685324e-1},
      {-10, 10, -9.43672726094016},
      {-8, 5, -2.97856807561527e-1},
      {-8, 12, 9.39353943717186e1},
      {-6, 3, 1.92944939465981e-2},
      {-6, 4, 4.21740664704763e-1},
      {-6, 22, -3.68914126282330e6},
      {-4, 2, -7.37566847600639e-3},
      {-4, 3, -3.54753242424366e-1},
      {-3, 7, -1.99768169338727},
      {-2, 3, 1.15456297059049},
      {-2, 16, 5.68366875815960e3},
      {-1, 0, 8.08169540124668e-3},
      {-1, 1, 1.72416341519307e-1},
      {-1, 2, 1.04270175292927},
      {-1, 3, -2.97691372792847e-1},
      {0, 0, 5.60394465163593e-1},
      {0, 1, 2.75234661176914e-1},
      {1, 0, -1.48347894866012e-1},
      {1, 1, -6.51142513478515e-2},
      {1, 2, -2.92468715386302},
      {2, 0, 6.64876096952665e-2},
      {2, 2, 3.52335014263844},
      {3, 0, -1.46340792313332e-2},
      {4, 2, -2.24503486668184},
      {5, 2, 1.10533464706142},
      {8, 2, -4.08757344495612e-2}};
  pi = pi + 0.128;
  eta = eta - 0.727;
  // omega = 0.0;
  // for (int k = 0; k < 32; k++)
  //   omega += IJn[k].n * pow(pi, IJn[k].I) * pow(eta, IJn[k].J);
  double omega = poly(pi, eta, 32, IJn);
  return (omega);
}

double ph2v3a_reg3(double p, double h)
{
  double eta, pi;
  pi = p / 100.0;
  eta = h / 2100.0;
  return (0.0028 * omega3aph(pi, eta));
}
//-------------------------------------------------
// (p,h)->v 3b
//--------------------------------------------------
double omega3bph(double pi, double eta)
{
  // Page 9
  // Table 7. Coefficients and exponents of the backward equation v3b (p,h) for subregion 3b in its
  // dimensionless form, Eq. (5)
  IJnData IJn[30] = {
      {-12, 0, -2.25196934336318e-9},
      {-12, 1, 1.40674363313486e-8},
      {-8, 0, 2.33784085280560e-6},
      {-8, 1, -3.31833715229001e-5},
      {-8, 3, 1.07956778514318e-3},
      {-8, 6, -2.71382067378863e-1},
      {-8, 7, 1.07202262490333},
      {-8, 8, -8.53821329075382e-1},
      {-6, 0, -2.15214194340526e-5},
      {-6, 1, 7.69656088222730e-4},
      {-6, 2, -4.31136580433864e-3},
      {-6, 5, 4.53342167309331e-1},
      {-6, 6, -5.07749535873652e-1},
      {-6, 10, -1.00475154528389e2},
      {-4, 3, -2.19201924648793e-1},
      {-4, 6, -3.21087965668917},
      {-4, 10, 6.07567815637771e2},
      {-3, 0, 5.57686450685932e-4},
      {-3, 2, 1.87499040029550e-1},
      {-2, 1, 9.05368030448107e-3},
      {-2, 2, 2.85417173048685e-1},
      {-1, 0, 3.29924030996098e-2},
      {-1, 1, 2.39897419685483e-1},
      {-1, 4, 4.82754995951394},
      {-1, 5, -1.18035753702231e1},
      {0, 0, 1.69490044091791e-1},
      {1, 0, -1.79967222507787e-2},
      {1, 1, 3.71810116332674e-2},
      {2, 2, -5.36288335065096e-2},
      {2, 6, 1.60697101092520}};
  pi = pi + 0.0661;
  eta = eta - 0.720;
  // omega = 0.0;
  // for (int k = 0; k < 30; k++)
  //  omega += IJn[k].n * pow(pi, IJn[k].I) * pow(eta, IJn[k].J);
  double omega = poly(pi, eta, 30, IJn);
  return (omega);
}

double ph2v3b_reg3(double p, double h)
{
  double eta, pi;
  pi = p / 100.0;
  eta = h / 2800.0;
  return (0.0088 * omega3bph(pi, eta));
}

//------------------------------------------------------------
// Region 3(3a,3b)  (p,h)->T
//------------------------------------------------------------

double ph2T_reg3(double p, double h)
{
  double T;
  double h3ab = p2h3ab(p);
  if (h <= h3ab)
  {
    T = ph2T3a_reg3(p, h);
  }
  else
  {
    T = ph2T3b_reg3(p, h);
  }
  return (T);
}

double ph2v_reg3(double p, double h)
{
  double v;
  double h3ab = p2h3ab(p);
  if (h <= h3ab)
  {
    v = ph2v3a_reg3(p, h);
  }
  else
  {
    v = ph2v3b_reg3(p, h);
  }
  return (v);
}

//------------------------------------------------------------
// (p,s)->T   3a Page 13, Table 11  Page 12 Eq(7)
//---------------------------------------------------------------
double theta3aps(double pi, double sigma)
{
  IJnData IJn[] = {{-12, 28, 0.150042008263875E+10},
                   {-12, 32, -0.159397258480424E+12},
                   {-10, 4, 0.502181140217975E-03},
                   {-10, 10, -0.672057767855466E+02},
                   {-10, 12, 0.145058545404456E+04},
                   {-10, 14, -0.823889534888890E+04},
                   {-8, 5, -0.154852214233853E+00},
                   {-8, 7, 0.112305046746695E+02},
                   {-8, 8, -0.297000213482822E+02},
                   {-8, 28, 0.438565132635495E+11},
                   {-6, 2, 0.137837838635464E-02},
                   {-6, 6, -0.297478527157462E+01},
                   {-6, 32, 0.971777947349413E+13},
                   {-5, 0, -0.571527767052398E-04},
                   {-5, 14, 0.288307949778420E+05},
                   {-5, 32, -0.744428289262703E+14},
                   {-4, 6, 0.128017324848921E+02},
                   {-4, 10, -0.368275545889071E+03},
                   {-4, 36, 0.664768904779177E+16},
                   {-2, 1, 0.449359251958880E-01},
                   {-2, 4, -0.422897836099655E+01},
                   {-1, 1, -0.240614376434179E+00},
                   {-1, 6, -0.474341365254924E+01},
                   {0, 0, 0.724093999126110E+00},
                   {0, 1, 0.923874349695897E+00},
                   {0, 4, 0.399043655281015E+01},
                   {1, 0, 0.384066651868009E-01},
                   {2, 0, -0.359344365571848E-02},
                   {2, 3, -0.735196448821653E+00},
                   {3, 2, 0.188367048396131E+00},
                   {8, 0, 0.141064266818704E-03},
                   {8, 1, -0.257418501496337E-02},
                   {10, 2, 0.123220024851555E-02}};
  pi = pi + 0.240;
  sigma = sigma - 0.703;
  // theta = 0.0;
  // for (int k = 0; k < 33; k++)
  //   theta += n[k] * pow(pi, i[k]) * pow(sigma, j[k]);
  double theta = poly(pi, sigma, 33, IJn);
  return (theta);
}

double ps2T3a_reg3(double p, double s)
{
  double pi, sigma;
  pi = p / 100.0;
  sigma = s / 4.4;
  return (760.0 * theta3aps(pi, sigma));
}
//------------------------------------------------------------
// (p,s)->T   3b  Page 13, Table 12, Page 12 Eq(7)
//---------------------------------------------------------------
double theta3bps(double pi, double sigma)
{
  IJnData IJn[28] = {{-12, 1, 0.527111701601660E+00},
                     {-12, 3, -0.401317830052742E+02},
                     {-12, 4, 0.153020073134484E+03},
                     {-12, 7, -0.224799398218827E+04},
                     {-8, 0, -0.193993484669048E+00},
                     {-8, 1, -0.140467557893768E+01},
                     {-8, 3, 0.426799878114024E+02},
                     {-6, 0, 0.752810643416743E+00},
                     {-6, 2, 0.226657238616417E+02},
                     {-6, 4, -0.622873556909932E+03},
                     {-5, 0, -0.660823667935396E+00},
                     {-5, 1, 0.841267087271658E+00},
                     {-5, 2, -0.253717501764397E+02},
                     {-5, 4, 0.485708963532948E+03},
                     {-5, 6, 0.880531517490555E+03},
                     {-4, 12, 0.265015592794626E+07},
                     {-3, 1, -0.359287150025783E+00},
                     {-3, 6, -0.656991567673753E+03},
                     {-2, 2, 0.241768149185367E+01},
                     {0, 0, 0.856873461222588E+00},
                     {2, 1, 0.655143675313458E+00},
                     {3, 1, -0.213535213206406E+00},
                     {4, 0, 0.562974957606348E-02},
                     {5, 24, -0.316955725450471E+15},
                     {6, 0, -0.699997000152457E-03},
                     {8, 3, 0.119845803210767E-01},
                     {12, 1, 0.193848122022095E-04},
                     {14, 2, -0.215095749182309E-04}};
  pi = pi + 0.760;
  sigma = sigma - 0.818;
  // theta = 0.0;
  // for (int k = 0; k < 28; k++)
  //   theta += n[k] * pow(pi, i[k]) * pow(sigma, j[k]);
  double theta = poly(pi, sigma, 28, IJn);
  return (theta);
}

double ps2T3b_reg3(double p, double s)
{
  double pi, sigma;
  pi = p / 100.0;
  sigma = s / 5.3;
  return (860.0 * theta3bps(pi, sigma));
}
//------------------------------------------------------------
// (p,s)->v  3a Page 15, Table 14  Page 14, Eq(8), Ok! 2003.12.18
//---------------------------------------------------------------
double omega3aps(double pi, double sigma)
{
  IJnData IJn[28] = {{-12, 10, 0.795544074093975E+02},
                     {-12, 12, -0.238261242984590E+04},
                     {-12, 14, 0.176813100617787E+05},
                     {-10, 4, -0.110524727080379E-02},
                     {-10, 8, -0.153213833655326E+02},
                     {-10, 10, 0.297544599376982E+03},
                     {-10, 20, -0.350315206871242E+08},
                     {-8, 5, 0.277513761062119},
                     {-8, 6, -0.523964271036888},
                     {-8, 14, -0.148011182995403E+06},
                     {-8, 16, 0.160014899374266E+07},
                     {-6, 28, 0.170802322663427E+13},
                     {-5, 1, 0.246866996006494E-03},
                     {-4, 5, 0.165326084797980E+01},
                     {-3, 2, -0.118008384666987},
                     {-3, 4, 0.253798642355900E+01},
                     {-2, 3, 0.965127704669424},
                     {-2, 8, -0.282172420532826E+02},
                     {-1, 1, 0.203224612353823},
                     {-1, 2, 0.110648186063513E+01},
                     {0, 0, 0.526127948451280},
                     {0, 1, 0.277000018736321},
                     {0, 3, 0.108153340501132E+01},
                     {1, 0, -0.744127885357893E-01},
                     {2, 0, 0.164094443541384E-01},
                     {4, 2, -0.680468275301065E-01},
                     {5, 2, 0.257988576101640E-01},
                     {6, 0, -0.145749861944416E-03}};

  pi = pi + 0.187;
  sigma = sigma - 0.755;
  // omega = 0.0;
  // for (int k = 0; k < 28; k++)
  //   omega += n[k] * pow(pi, i[k]) * pow(sigma, j[k]);
  double omega = poly(pi, sigma, 28, IJn);
  return (omega);
}

double ps2v3a_reg3(double p, double s)
{
  double pi, sigma;
  pi = p / 100.0;
  sigma = s / 4.4;
  return (0.0028 * omega3aps(pi, sigma));
}
//-------------------------------------------------------------------
// (p,s)->v  3b Page 15, Table 15  Page 14, Eq(9)   OK! 2003.12.18
//-------------------------------------------------------------------
double omega3bps(double pi, double sigma)
{
  IJnData IJn[] = {{-12, 0, 0.591599780322238E-04},
                   {-12, 1, -0.185465997137856E-02},
                   {-12, 2, 0.104190510480013E-01},
                   {-12, 3, 0.598647302038590E-02},
                   {-12, 5, -0.771391189901699},
                   {-12, 6, 0.172549765557036E+01},
                   {-10, 0, -0.467076079846526E-03},
                   {-10, 1, 0.134533823384439E-01},
                   {-10, 2, -0.808094336805495E-01},
                   {-10, 4, 0.508139374365767},
                   {-8, 0, 0.128584643361683E-02},
                   {-5, 1, -0.163899353915435E+01},
                   {-5, 2, 0.586938199318063E+01},
                   {-5, 3, -0.292466667918613E+01},
                   {-4, 0, -0.614076301499537E-02},
                   {-4, 1, 0.576199014049172E+01},
                   {-4, 2, -0.121613320606788E+02},
                   {-4, 3, 0.167637540957944E+01},
                   {-3, 1, -0.744135838773463E+01},
                   {-2, 0, 0.378168091437659E-01},
                   {-2, 1, 0.401432203027688E+01},
                   {-2, 2, 0.160279837479185E+02},
                   {-2, 3, 0.317848779347728E+01},
                   {-2, 4, -0.358362310304853E+01},
                   {-2, 12, -0.115995260446827E+07},
                   {0, 0, 0.199256573577909},
                   {0, 1, -0.122270624794624},
                   {0, 2, -0.191449143716586E+02},
                   {1, 0, -0.150448002905284E-01},
                   {1, 2, 0.146407900162154E+02},
                   {2, 2, -0.327477787188230E+01}};

  pi = pi + 0.298;
  sigma = sigma - 0.816;
  // omega = 0.0;
  // for (int k = 0; k < 31; k++)
  //   omega += n[k] * pow(pi, i[k]) * pow(sigma, j[k]);
  double omega = poly(pi, sigma, 31, IJn);
  return (omega);
}

double ps2v3b_reg3(double p, double s)
{
  double pi, sigma;
  pi = p / 100.0;
  sigma = s / 5.3;
  return (0.0088 * omega3bps(pi, sigma));
}

double ps2T_reg3(double p, double s)
{
  double T;
  if (s <= sc_water)
  {
    T = ps2T3a_reg3(p, s);
  }
  else
  {
    T = ps2T3b_reg3(p, s);
  }
  return (T);
}

double ps2v_reg3(double p, double s)
{
  double v;

  if (s <= sc_water)
  {
    v = ps2v3a_reg3(p, s);
  }
  else
  {
    v = ps2v3b_reg3(p, s);
  }
  return (v);
}
